{let c=chrome,m=c.contextMenus,f=(a,b)=>(b||a).url[0]!="c"&&c.scripting.executeScript({target:b?typeof a=="string"?{tabId:b.id,allFrames:!0}:{tabId:b.id,frameIds:[a.frameId]}:{tabId:a.id,allFrames:!0},world:"MAIN",func:async()=>{let v=document.getElementsByTagName("video"),i=v.length;if(i){let r=Array(i);while(r[--i]=v[i].offsetWidth,i);if((v=v[r.indexOf(Math.max(...r))]).readyState){v.pause();try{return[r=v.currentTime,((i=new OffscreenCanvas(v.videoWidth,v.videoHeight)).getContext("bitmaprenderer").transferFromImageBitmap(await createImageBitmap(v)),URL.createObjectURL(await i.convertToBlob()))]}catch(e){return e=v.getAttribute("style"),i=v.controls,setTimeout(()=>(v.controls=i,e?v.setAttribute("style",e):v.removeAttribute("style")),960),v.controls&&=0,v.setAttribute("style",e+";all:unset!important;position:fixed;!important;z-index:2147483222647!important;inset:0!important;width:"+v.videoWidth+"px!important;height:"+v.videoHeight+"px!important"),[r,v.videoWidth,v.videoHeight]}}}}},async e=>(e=(e.find(v=>v.result))?.result)&&(p=(p=(await c.management.getAll()).find(v=>v.name=="file.format"))&&await c.runtime.connect(p.id),await c.downloads.download({filename:(b||a).title.replace(/[|?":/<>*\\]/g,"_")+"-"+((m=e[0])>=3600?(m%3600^0)+"h-":"")+((f=m%3600/60^0)?f+"m-":"")+((f=m%60^0)?f+"s-":"")+((f=(m%60-f)*1e3)^0)+"ms.png",url:e.length<3?e[1]:await new Promise(async r=>(e=new OffscreenCanvas(e[1],e[2]),e.getContext("2d",{alpha:!(m=chrome.debugger).attach(b={tabId:(b||a).id},"1.3")}).drawImage(await createImageBitmap(await(await fetch("data:image/png;base64,"+(await m.sendCommand(b,"Page.captureScreenshot",{captureBeyondViewport:!0})).data)).blob()),0,0),(a=new FileReader).onload=()=>(m.detach(b),r(a.result)),a.readAsDataURL(await e.convertToBlob())))}),p&&p.disconnect())),p;c.runtime.onInstalled.addListener(()=>m.create({id:"",title:"Save video frame as...",contexts:["page","video"]})),m.onClicked.addListener(f),c.action.onClicked.addListener(f),c.commands.onCommand.addListener(f)}